<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>学習情報編集</title>
  <link rel="stylesheet" th:href="@{/css/chart_edit.css}">
  <th:block th:remove="all">
    <link rel="stylesheet" href="../static/css/chart_edit.css">
  </th:block>
</head>
<body>
  <header>
    <div class="header-title">
      <a th:href="@{/top}" style="color: inherit; text-decoration: none;">My Portfolio</a>
    </div>
    <form th:action="@{/logout}" method="post" class="logout">
      <button type="submit">ログアウト</button>
    </form>
  </header>

  <main>
    <div class="month-select">
      <form method="get" th:action="@{/chart/edit}">
        <select name="month" onchange="this.form.submit()">
          <option th:each="m : ${months}"
                  th:value="${m}"
                  th:text="${m + '月'}"
                  th:selected="${m == currentMonth}">
          </option>
        </select>
      </form>
    </div>

    <!-- バックエンド -->
    <section class="category-section">
      <div class="category-header">
        <h2>バックエンド</h2>
        <form method="get" th:action="@{/skill/add}">
          <input type="hidden" name="category" value="1" />
          <input type="hidden" name="month" th:value="${currentMonth}" />
          <button type="submit" class="add-button">項目を追加する</button>
        </form>
      </div>
      <table>
        <colgroup>
          <col style="width:240px">
          <col style="width:240px">
          <col style="width:200px">
          <col style="width:200px">
        </colgroup>
        <thead>
          <tr>
            <th>項目名</th>
            <th>学習時間</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="item : ${backendItems}" th:if="${item.itemName}">
            <form th:action="@{/skill/update}" method="post">
              <input type="hidden" name="id" th:value="${item.id}" />
              <input type="hidden" name="itemName" th:value="${item.itemName}" />
              <input type="hidden" name="studyMonth" th:value="${currentMonth}" />
              <td th:text="${item.itemName}">Java</td>
              <td>
                <input type="number"
                      name="studyMinutes"
                      th:value="${item.studyMinutes}"
                      min="0"
                      required
                      step="1" />
              </td>
              <td>
                <button type="submit" class="save-button">学習時間を保存する</button>
              </td>
            </form>  
            <form th:action="@{/skill/delete}" method="post">
              <input type="hidden" name="id" th:value="${item.id}" />
              <input type="hidden" name="itemName" th:value="${item.itemName}" />
              <input type="hidden" name="studyMonth" th:value="${currentMonth}" />
              <td>
                <button class="delete-button">削除する</button>
              </td>
            </form>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- フロントエンド -->
    <section class="category-section">
      <div class="category-header">
        <h2>フロントエンド</h2>
        <form method="get" th:action="@{/skill/add}">
          <input type="hidden" name="category" value="2" />
          <input type="hidden" name="month" th:value="${currentMonth}" />
          <button type="submit" class="add-button">項目を追加する</button>
        </form>
      </div>
      <table>
        <colgroup>
          <col style="width:240px">
          <col style="width:240px">
          <col style="width:200px">
          <col style="width:200px">
        </colgroup>
        <thead>
          <tr>
            <th>項目名</th>
            <th>学習時間</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="item : ${frontendItems}" th:if="${item.itemName}">
            <form th:action="@{/skill/update}" method="post">
              <input type="hidden" name="id" th:value="${item.id}" />
              <input type="hidden" name="itemName" th:value="${item.itemName}" />
              <input type="hidden" name="studyMonth" th:value="${currentMonth}" />
              <td th:text="${item.itemName}">Java</td>
              <td>
                <input type="number"
                      name="studyMinutes"
                      th:value="${item.studyMinutes}"
                      min="0"
                      required
                      step="1" />
              </td>
              <td>
                <button class="save-button">学習時間を保存する</button>
              </td>
            </form>
            <form th:action="@{/skill/delete}" method="post">
              <input type="hidden" name="id" th:value="${item.id}" />
              <input type="hidden" name="itemName" th:value="${item.itemName}" />
              <input type="hidden" name="studyMonth" th:value="${currentMonth}" />
              <td>
                <button class="delete-button">削除する</button>
              </td>
            </form>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- インフラ -->
    <section class="category-section">
      <div class="category-header">
        <h2>インフラ</h2>
        <form method="get" th:action="@{/skill/add}">
          <input type="hidden" name="category" value="3" />
          <input type="hidden" name="month" th:value="${currentMonth}" />
          <button type="submit" class="add-button">項目を追加する</button>
        </form>
      </div>
      <table>
        <colgroup>
          <col style="width:240px">
          <col style="width:240px">
          <col style="width:200px">
          <col style="width:200px">
        </colgroup>
        <thead>
          <tr>
            <th>項目名</th>
            <th>学習時間</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="item : ${infraItems}" th:if="${item.itemName}">
            <form th:action="@{/skill/update}" method="post">
              <input type="hidden" name="id" th:value="${item.id}" />
              <input type="hidden" name="itemName" th:value="${item.itemName}" />
              <input type="hidden" name="studyMonth" th:value="${currentMonth}" />
              <td th:text="${item.itemName}">Java</td>
              <td>
                <input type="number"
                      name="studyMinutes"
                      th:value="${item.studyMinutes}"
                      min="0"
                      required
                      step="1" /> 
              </td>
              <td>
                <button class="save-button">学習時間を保存する</button>
              </td>
            </form>
            <form th:action="@{/skill/delete}" method="post">
              <input type="hidden" name="id" th:value="${item.id}" />
              <input type="hidden" name="itemName" th:value="${item.itemName}" />
              <input type="hidden" name="studyMonth" th:value="${currentMonth}" />
              <td>
                <button class="delete-button">削除する</button>
              </td>
            </form>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>portfolio site</p>
  </footer>

  <div th:if="${updated}" class="modal">
    <div class="modal-content">
        <div class="modal-text">
            <p th:text="${itemName + 'の学習時間を保存しました！'}">{項目名} の学習時間を保存しました！</p>
        </div>
        <a th:href="@{/chart/edit(month=${month})}" class="modal-button">編集ページに戻る</a>
    </div>  
  </div>

    <div th:if="${deleted}" class="modal">
    <div class="modal-content">
        <div class="modal-text">
            <p th:text="${itemName + 'を削除しました！'}">{項目名}を削除しました！</p>
        </div>
        <a th:href="@{/chart/edit(month=${month})}" class="modal-button">編集ページに戻る</a>
    </div>  
  </div>

</body>
</html>
